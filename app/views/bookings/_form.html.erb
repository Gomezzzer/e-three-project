<%= form_with(model: booking, method: "post", id: "booking-form") do |form| %>
  <%= form.hidden_field :client_id, value: current_user.id %>
  <%= form.collection_select :trainer_id, @trainers_array, :id, :first_name, { prompt: "Select Trainer" }, id: "trainer-select" %>
  <%= form.select :started_at, options_for_select([]), { prompt: "Select Start Time" }, id: "start-time-select" %>
  <%= form.hidden_field :ended_at, value: @date %>
  <%= form.submit "Submit" %>
<% end %>

<hr>

<script>
  var hourlySlots = <%= raw @hourly_slots.to_json %>;

  function populateTimeSlots() {
    const trainerSelect = document.getElementById("trainer-select").value;
    const timeSlots = document.getElementById("start-time-select");

    const filteredData = hourlySlots.filter(function(hash) {
      return hash.trainer_id.toString() === trainerSelect;
    })

    const options = filteredData.map(function(hash) {
      return hash.started_at;
    })

    timeSlots.innerHTML = "";

    options.forEach(optionText => {
      const option = new Option(optionText, optionText);
      timeSlots.add(option);
    });
  }

  document.getElementById("trainer-select").addEventListener("change", populateTimeSlots);
  populateTimeSlots();
</script>
